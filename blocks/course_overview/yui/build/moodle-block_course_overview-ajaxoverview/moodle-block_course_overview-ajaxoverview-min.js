YUI.add("moodle-block_course_overview-ajaxoverview",function(e,t){M.block_course_overview=M.block_course_overview||{},M.block_course_overview.ajaxoverview=M.block_course_overview.ajaxoverview||{};var n=M.block_course_overview.ajaxoverview,r={GETOVERVIEW:M.cfg.wwwroot+"/blocks/course_overview/getoverview_ajax.php"},i={COLLAPSIBLEREGION:".collapsibleregion",COURSETITLE:".course_title",LOADINGINDICATOR:".block_course_overview .loadingoverview",COURSECHILDREN:".coursechildren"},s={STATEWARNING:"i/warning"};n.CollapsibleRegion=function(){n.CollapsibleRegion.superclass.constructor.apply(this,arguments)},n.CollapsibleRegion=function(t,n,r){this.userpref=n,this.div=e.one("#"+t);var i=this.div.one("#"+t+"_caption");i.setAttribute("title",r);var s=e.Node.create('<a href="#"></a>'),o=function(e){e.remove(),s.append(e)};i.get("children").each(o,this),i.prepend(s);var u=this.div.get("offsetHeight");this.div.hasClass("collapsed")&&this.div.setStyle("height",i.get("offsetHeight")+"px");var a=new e.Anim({node:this.div,duration:.3,easing:e.Easing.easeBoth,to:{height:i.get("offsetHeight")},from:{height:u}});a.on("end",function(){this.div.toggleClass("collapsed")},this),i.on("click",function(e,t){e.preventDefault(),t.get("running")&&t.stop(),t.set("reverse",this.div.hasClass("collapsed")),this.userpref&&M.util.set_user_preference(this.userpref,!this.div.hasClass("collapsed")),t.run()},this,a)},n.CollapsibleRegion.prototype.userpref=null,n.CollapsibleRegion.prototype.div=null,n.CollapsibleRegion.prototype.icon=null,n.init=function(t){n.courseIds=t.courseIds,n.step=t.overviewStep;if(n.courseIds.length>0){var i=n.courseIds.splice(0,n.step),s={courseids:i.join()};e.io(r.GETOVERVIEW,{method:"GET",data:s,arguments:i,on:{complete:n.handleNextOverview}})}},n.handleNextOverview=function(t,s,o){try{if(s.status==200&&s.responseText){var u=e.JSON.parse(s.responseText);u.error?n.addErrorState(o,u.error):(n.removeOverviewState(o),u.coursecount>0&&e.Array.each(u.coursedata,function(t){var r=e.one("div#course-"+t.id),s=r.one("> "+i.COURSECHILDREN);s||(s=r.one("> "+i.COURSETITLE)),s.insert(t.content,"after");var o=r.all(i.COLLAPSIBLEREGION);o.each(function(e){new n.CollapsibleRegion(e.get("id"),!1,M.util.get_string("clicktohideshow","moodle"))})}))}else s.status!=200?n.addErrorState(o,"Request status returned: "+s.status):n.removeOverviewState(o)}catch(a){n.addErrorState(o,a)}if(n.courseIds.length>0){var f=n.courseIds.splice(0,n.step),l={courseids:f.join()};e.io(r.GETOVERVIEW,{method:"GET",data:l,arguments:f,on:{complete:n.handleNextOverview}})}else{var c=e.one(i.LOADINGINDICATOR);c.hide(!0)}},n.removeOverviewState=function(t){e.Array.each(t,function(t){e.one("div#course-"+t+" .overview_state").remove()})},n.addErrorState=function(t,n){e.Array.each(t,function(t){var r=e.one("div#course-"+t+" .overview_state");r.setAttribute("src",M.util.image_url(s.STATEWARNING,"moodle")),r.setAttribute("title",n)})}},"@VERSION@",{requires:["base","io-base","querystring-stringify-simple","json-parse","node","anim"]});
